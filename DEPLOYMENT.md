# ğŸš€ Deployment Guide - Baitybites OMS

## Architecture Overview

Baitybites adalah full-stack application yang memerlukan:
1. **Backend Server** (Bun + ElysiaJS + PostgreSQL)
2. **Frontend** (Static HTML/CSS/JS)

## ğŸ“¦ Deployment Options

### Option 1: Hybrid Deployment (Recommended)

#### Frontend â†’ Netlify
- Domain: `https://baitybites.netlify.app`
- Serves static files only
- Proxies API calls to backend

#### Backend â†’ Railway/Render
- Runs Bun runtime
- Hosts API endpoints
- Connects to PostgreSQL database

### Option 2: All-in-One Deployment

Deploy everything to Railway/Render/Fly.io

---

## ğŸŒ Netlify Setup (Frontend Only)

### 1. Connect Repository
1. Login ke [Netlify](https://app.netlify.com)
2. Click "Add new site" â†’ "Import an existing project"
3. Connect GitHub repository
4. Configure build settings:
   - **Build command**: `echo "Static files only"`
   - **Publish directory**: `public`

### 2. Environment Variables di Netlify

âš ï¸ **PENTING**: Set variable berikut di Netlify Dashboard â†’ Site settings â†’ Environment variables:

```bash
# API Backend URL (ganti dengan URL Railway Anda)
VITE_API_URL=https://baitybites-api.railway.app
```

### 3. Update netlify.toml

File `netlify.toml` sudah dibuat. **EDIT baris berikut**:

```toml
[[redirects]]
  from = "/api/*"
  to = "https://baitybites-api.railway.app/api/:splat"  # â† Ganti dengan URL backend Anda
```

---

## ğŸš‚ Railway Setup (Backend)

### 1. Create New Project
1. Login ke [Railway](https://railway.app)
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your Baitybites repository

### 2. Add PostgreSQL Database
1. Click "New" â†’ "Database" â†’ "Add PostgreSQL"
2. Railway akan auto-generate `DATABASE_URL`

### 3. Environment Variables di Railway

Set variable berikut di Railway Dashboard:

```bash
# Auto-generated by Railway
DATABASE_URL=postgresql://...  # â† Sudah otomatis

# Manual setup
JWT_SECRET=generate-random-32-char-string-here
NODE_ENV=production
PORT=9876
FRONTEND_URL=https://baitybites.netlify.app

# Optional (jika sudah setup Google OAuth)
# GOOGLE_CLIENT_ID=your_client_id
# GOOGLE_CLIENT_SECRET=your_client_secret
# GOOGLE_REDIRECT_URI=https://your-backend.railway.app/api/auth/google/callback
```

### 4. Generate JWT Secret

Jalankan di terminal:
```bash
openssl rand -base64 32
```
Copy hasilnya ke `JWT_SECRET`

### 5. Deploy Settings
Railway akan auto-detect `railway.toml` dan:
- Install dependencies dengan `bun install`
- Start server dengan `bun run index.ts`
- Health check di `/api/health`

---

## ğŸ”„ Update Frontend API URL

Edit file `public/js/app.js`:

```javascript
// Ganti baris ini:
const API_BASE = window.location.origin + '/api';

// Menjadi:
const API_BASE = 'https://baitybites-api.railway.app/api';
```

**ATAU** gunakan environment variable (lebih baik):

```javascript
const API_BASE = import.meta.env.VITE_API_URL || window.location.origin + '/api';
```

---

## âœ… Checklist Deployment

### Pre-deployment
- [ ] Copy `.env.example` ke `.env` dan isi values
- [ ] Test aplikasi di local: `bun run dev`
- [ ] Commit semua changes ke Git
- [ ] Push ke GitHub

### Netlify (Frontend)
- [ ] Connect GitHub repo
- [ ] Set build command: `echo "Static files only"`
- [ ] Set publish directory: `public`
- [ ] Add environment variable: `VITE_API_URL`
- [ ] Update `netlify.toml` dengan backend URL
- [ ] Deploy!

### Railway (Backend)
- [ ] Create new project dari GitHub
- [ ] Add PostgreSQL database
- [ ] Set environment variables (lihat list di atas)
- [ ] Generate JWT secret
- [ ] Deploy!
- [ ] Copy Railway URL (e.g., `https://baitybites-api.railway.app`)

### Post-deployment
- [ ] Update `netlify.toml` dengan Railway URL
- [ ] Update `public/js/app.js` dengan Railway API URL
- [ ] Re-deploy Netlify
- [ ] Test login di `https://baitybites.netlify.app`
- [ ] Test API calls
- [ ] Run database migrations di Railway
- [ ] Seed initial data (admin user)

---

## ğŸ› Troubleshooting

### CORS Error
**Problem**: Frontend tidak bisa akses backend API

**Solution**: 
1. Pastikan `FRONTEND_URL` di Railway = `https://baitybites.netlify.app`
2. Check CORS config di `index.ts`

### Database Connection Error
**Problem**: Backend tidak bisa connect ke database

**Solution**:
1. Verify `DATABASE_URL` di Railway environment variables
2. Pastikan PostgreSQL service running
3. Check database logs di Railway

### 404 on Page Refresh
**Problem**: Netlify return 404 saat refresh page

**Solution**: 
`netlify.toml` sudah include SPA fallback redirect. Pastikan file ada.

### API Calls Return 401
**Problem**: Authentication failed

**Solution**:
1. Check `JWT_SECRET` sama di backend
2. Clear browser cookies
3. Login ulang

---

## ğŸ“Š Monitoring

### Railway
- View logs: Railway Dashboard â†’ Deployments â†’ Logs
- Metrics: CPU, Memory, Network usage
- Database: Query performance, connections

### Netlify
- Deploy logs: Netlify Dashboard â†’ Deploys
- Analytics: Page views, bandwidth
- Forms: Submissions (jika ada)

---

## ğŸ” Security Checklist

- [ ] Change `JWT_SECRET` dari default
- [ ] Use strong database password
- [ ] Enable HTTPS (auto di Netlify & Railway)
- [ ] Set proper CORS origins
- [ ] Add rate limiting (future)
- [ ] Enable database backups di Railway
- [ ] Use environment variables (never commit secrets)

---

## ğŸ“ Notes

1. **Netlify Free Tier**: 100GB bandwidth/month, 300 build minutes
2. **Railway Free Tier**: $5 credit/month, then pay-as-you-go
3. **Database**: Railway PostgreSQL included in free tier
4. **Custom Domain**: Bisa add di Netlify (gratis) dan Railway (gratis)

---

## ğŸ†˜ Need Help?

- Railway Docs: https://docs.railway.app
- Netlify Docs: https://docs.netlify.com
- Bun Docs: https://bun.sh/docs
