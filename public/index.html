<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baitybites - Risol Mayo Premium</title>
    <link rel="icon" type="image/png" href="/assets/favicon.png">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
    <div class="page-wrapper">
        <header class="header"
            style="position: fixed; width: 100%; top: 0; background: rgba(0,0,0,0.3); border-bottom: none; backdrop-filter: blur(5px);">
            <div class="container">
                <div class="header-content">
                    <a href="/" class="logo">
                        <img src="/assets/logo.png" alt="Baitybites Logo" style="height: 50px;">
                    </a>
                    <nav class="nav" id="mainNav"></nav>
                </div>
            </div>
        </header>

        <div class="hero-section">
            <div class="hero-bg"></div>

            <div class="hero-content">
                <div class="hero-logo">
                    <img src="/assets/logo.png" alt="Baitybites Logo">
                </div>

                <h1 class="hero-title">Risol Mayo Premium</h1>
                <p class="hero-description">
                    Sensasi kelezatan kulit krispi yang gurih berpadu dengan limpahan saus mayo premium yang lembut dan
                    meleleh di mulut. Dibuat dengan bahan pilihan untuk gigitan yang tak terlupakan.
                </p>

                <div class="button-group"
                    style="display: flex; gap: 1.5rem; justify-content: center; flex-wrap: wrap; animation: fadeInUp 1.2s ease-out 0.3s both;">
                    <a href="/order.html" class="cta-button">
                        <span>Pesan Sekarang</span>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </a>

                    <a href="/track.html" class="cta-button secondary">
                        <span>Lihat Pesanan Saya</span>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </a>
                </div>
            </div>

            <a href="#gallery" class="scroll-indicator" title="Lihat Galeri">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M7 13l5 5 5-5M7 6l5 5 5-5"></path>
                </svg>
            </a>
        </div>

        <!-- Gallery Section -->
        <section id="gallery" class="gallery-section">
            <h2>Galeri Kelezatan</h2>
            <div class="gallery-grid" id="gallery-container">
                <!-- Dynamic Content -->
            </div>
            <p class="footer-text">
                Setiap gigitan adalah perpaduan sempurna antara kerenyahan dan kelembutan.
            </p>
        </section>

        <!-- Testimony Section -->
        <section id="testimony" class="testimony-section">
            <h2>Apa Kata Mereka?</h2>
            <div class="testimony-grid" id="testimony-container">
                <!-- Dynamic Content -->
            </div>

            <!-- Add Testimony Section -->
            <!-- Add Testimony Section -->
            <div class="testimony-form-card">
                <h3>Punya Cerita Kelezatan?</h3>
                <p>Bagikan pengalaman Anda menikmati Risol Mayo Baitybites.</p>
                <button onclick="showTestimonyForm()" class="cta-button">
                    <span>Tulis Testimoni</span>
                </button>
            </div>
        </section>

        <!-- Testimony Modal -->
        <div id="testimonyModal" class="modal-overlay" style="display: none;">
            <div class="modal" style="max-width: 500px;">
                <div class="modal-header">
                    <h2 class="modal-title">Kirim Testimoni</h2>
                    <button type="button" class="modal-close" onclick="hideTestimonyForm()">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-4">Testimoni Anda akan ditampilkan setelah dimoderasi oleh admin.</p>
                    <form id="testimonyForm">
                        <div class="form-group">
                            <label class="form-label">Nama Anda</label>

                            <!-- Guest / Alias Input -->
                            <div id="nameInputWrapper">
                                <input type="text" id="testName" class="form-input" placeholder="Nama Anda" required>
                            </div>

                            <!-- Logged In User Display -->
                            <div id="loggedInUserDisplay"
                                style="display: none; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; background: var(--neutral-100); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                                <div style="display: flex; flex-direction: column;">
                                    <span class="text-muted" style="font-size: 0.8rem;">Posting sebagai:</span>
                                    <strong id="currentUserName" style="font-size: 1rem;">User Name</strong>
                                </div>
                                <button type="button" onclick="enableAliasMode()" class="btn btn-outline btn-sm"
                                    style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">Gunakan Nama Samaran</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Testimoni</label>
                            <textarea id="testContent" class="form-textarea" placeholder="Bagikan pengalaman Anda..."
                                required style="height: 120px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="margin-bottom: 0.5rem;">Rating</label>
                            <div class="rating">
                                <input type="radio" id="star5" name="rating" value="5" checked /><label for="star5"
                                    title="Sangat Puas"><svg viewBox="0 0 24 24">
                                        <path
                                            d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                    </svg></label>
                                <input type="radio" id="star4" name="rating" value="4" /><label for="star4"
                                    title="Puas"><svg viewBox="0 0 24 24">
                                        <path
                                            d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                    </svg></label>
                                <input type="radio" id="star3" name="rating" value="3" /><label for="star3"
                                    title="Biasa Saja"><svg viewBox="0 0 24 24">
                                        <path
                                            d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                    </svg></label>
                                <input type="radio" id="star2" name="rating" value="2" /><label for="star2"
                                    title="Kurang Puas"><svg viewBox="0 0 24 24">
                                        <path
                                            d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                    </svg></label>
                                <input type="radio" id="star1" name="rating" value="1" /><label for="star1"
                                    title="Kecewa"><svg viewBox="0 0 24 24">
                                        <path
                                            d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                    </svg></label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="hideTestimonyForm()" class="btn btn-outline"
                        style="min-width: 100px;">Batal</button>
                    <button type="submit" form="testimonyForm" class="btn btn-primary" style="flex: 1;">Kirim
                        Testimoni</button>
                </div>
            </div>
        </div>

        <script src="/js/app.js"></script>
        <script>
            function showTestimonyForm() {
                const userStr = localStorage.getItem('user');
                const nameInputWrapper = document.getElementById('nameInputWrapper');
                const loggedInUserDisplay = document.getElementById('loggedInUserDisplay');
                const testNameInput = document.getElementById('testName');
                const currentUserNameSpan = document.getElementById('currentUserName');

                if (userStr) {
                    // Logged In
                    const user = JSON.parse(userStr);

                    nameInputWrapper.style.display = 'none';
                    loggedInUserDisplay.style.display = 'flex';
                    currentUserNameSpan.textContent = user.name;

                    // Pre-fill hidden input but remove required attribute to avoid browser validation errors on hidden field
                    testNameInput.value = user.name;
                    testNameInput.removeAttribute('required');
                } else {
                    // Guest
                    nameInputWrapper.style.display = 'block';
                    loggedInUserDisplay.style.display = 'none';

                    testNameInput.value = '';
                    testNameInput.setAttribute('required', 'true');
                }

                document.getElementById('testimonyModal').style.display = 'flex';
            }

            function enableAliasMode() {
                const nameInputWrapper = document.getElementById('nameInputWrapper');
                const loggedInUserDisplay = document.getElementById('loggedInUserDisplay');
                const testNameInput = document.getElementById('testName');

                loggedInUserDisplay.style.display = 'none';
                nameInputWrapper.style.display = 'block';

                testNameInput.focus();
                testNameInput.select();
                testNameInput.setAttribute('required', 'true');
            }

            function hideTestimonyForm() {
                document.getElementById('testimonyModal').style.display = 'none';
            }

            async function loadContent() {
                try {
                    // Check for Elfsight Widget first
                    const widgetRes = await fetch('/api/public/instagram-widget');
                    const widgetJson = await widgetRes.json();
                    const galContainer = document.getElementById('gallery-container');

                    if (widgetJson.success && widgetJson.data) {
                        // Display Elfsight Widget - need to properly execute script tags
                        galContainer.innerHTML = '';

                        // Create a temporary div to parse the widget HTML
                        const tempDiv = document.createElement('div');
                        tempDiv.style.width = '100%';
                        tempDiv.style.gridColumn = '1 / -1';
                        tempDiv.innerHTML = widgetJson.data;

                        // Extract and execute script tags
                        const scripts = tempDiv.querySelectorAll('script');
                        scripts.forEach(oldScript => {
                            const newScript = document.createElement('script');
                            Array.from(oldScript.attributes).forEach(attr => {
                                newScript.setAttribute(attr.name, attr.value);
                            });
                            newScript.textContent = oldScript.textContent;
                            oldScript.parentNode.replaceChild(newScript, oldScript);
                        });

                        galContainer.appendChild(tempDiv);
                    } else {
                        // Fallback to database gallery
                        const resGal = await fetch('/api/public/gallery');
                        const galJson = await resGal.json();
                        if (galJson.success) {
                            galContainer.innerHTML = galJson.data.map(item => `
                            <div class="gallery-item">
                                <img src="${item.image_url}" alt="${item.title || 'Galeri BaityBites'}">
                            </div>
                        `).join('');
                        }
                    }

                    // Load Testimonials
                    const resTest = await fetch('/api/public/testimonials');
                    const testJson = await resTest.json();
                    const testContainer = document.getElementById('testimony-container');

                    if (testJson.success) {
                        const renderStars = (rating) => {
                            let stars = '';
                            for (let i = 1; i <= 5; i++) {
                                stars += `<svg class="star ${i <= rating ? 'filled' : ''}" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`;
                            }
                            return stars;
                        };

                        const formatDate = (dateStr) => {
                            const date = new Date(dateStr);
                            const now = new Date();
                            const diffTime = Math.abs(now - date);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                            if (diffDays < 1) return 'Hari ini';
                            if (diffDays < 7) return `${diffDays} hari yang lalu`;
                            return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
                        };

                        testContainer.innerHTML = testJson.data.map((t, idx) => `
                        <div class="testimony-card">
                            <div class="testimony-rating">
                                ${renderStars(t.rating)}
                            </div>
                            <p class="quote">"${t.content}"</p>
                            <div class="user-info">
                                <img src="${t.avatar_url || '/assets/avatar-1.png'}" alt="${t.name}">
                                <div>
                                    <h4>
                                        ${t.name}
                                        ${t.role === 'Verified Customer' ? '<span class="verified-badge"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></span>' : ''}
                                    </h4>
                                    <div class="user-meta">
                                        <span class="role">${t.role || 'Pelanggan'}</span>
                                        <span class="dot">â€¢</span>
                                        <span class="date">${formatDate(t.created_at)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    }
                } catch (e) {
                    console.error('Gagal memuat konten:', e);
                }
            }

            loadContent();

            // Magic Sparkles Animation
            const button = document.querySelector('.cta-button');
            button.addEventListener('mousemove', (e) => {
                if (Math.random() > 0.8) createSparkle(e.clientX, e.clientY);
            });

            function createSparkle(x, y) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                const size = Math.random() * 8 + 4;
                sparkle.style.width = size + 'px';
                sparkle.style.height = size + 'px';
                sparkle.style.left = x + 'px';
                sparkle.style.top = y + 'px';
                const color = ['#f59638', '#fff', '#ec6817'][Math.floor(Math.random() * 3)];
                sparkle.style.background = color;
                sparkle.style.boxShadow = `0 0 10px ${color}`;
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 800);
            }

            setInterval(() => {
                const content = document.querySelector('.hero-content');
                if (content) {
                    const rect = content.getBoundingClientRect();
                    createSparkle(rect.left + Math.random() * rect.width, rect.top + Math.random() * rect.height);
                }
            }, 1500);

            // Testimony Form Submission
            document.getElementById('testimonyForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const { apiCall, showNotification } = window.app;
                const userStr = localStorage.getItem('user');
                const user = userStr ? JSON.parse(userStr) : null;

                const payload = {
                    name: document.getElementById('testName').value,
                    content: document.getElementById('testContent').value,
                    rating: parseInt(document.querySelector('input[name="rating"]:checked')?.value || 5),
                    avatar_url: user?.avatar_url || null,
                    role: user?.is_google ? 'Verified Customer' : 'Pelanggan'
                };

                try {
                    const result = await apiCall('/customer/testimony', {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });

                    if (result.success) {
                        showNotification('Terima kasih! Testimoni Anda sedang dimoderasi.', 'success');
                        hideTestimonyForm();
                    }
                } catch (error) {
                    console.error('Testimony submit error:', error);
                }
            });
        </script>
        <footer style="background: var(--neutral-900); color: white; padding: 4rem 0; text-align: center;">
            <div class="container">
                <img src="/assets/logo.png" alt="Baitybites Logo"
                    style="height: 60px; margin-bottom: 2rem; filter: brightness(0) invert(1);">
                <p style="color: var(--neutral-400); margin-bottom: 2rem;">Risol Mayo Premium dengan cita rasa otentik
                    dan bahan berkualitas.</p>
                <div style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem;">
                    <a href="/order.html" style="color: white; text-decoration: none;">Pesan Sekarang</a>
                    <a href="/track.html" style="color: white; text-decoration: none;">Lacak Pesanan</a>
                </div>
                <div id="footer-contact" style="margin-bottom: 2rem; color: var(--neutral-400);">
                    <!-- Dynamic Contact Info -->
                </div>

                <div id="footer-socials"
                    style="display: flex; justify-content: center; margin-bottom: 2rem; gap: 1rem; color: white;">
                    <!-- Dynamic Social Links -->
                </div>
                <div style="height: 1px; background: rgba(255,255,255,0.1); margin-bottom: 2rem;"></div>
                <div
                    style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1.5rem; font-size: 0.9rem; color: var(--neutral-500);">
                    <span>&copy; 2026 Baitybites. All rights reserved.</span>
                    <a href="/privacy.html" style="color: var(--neutral-500); text-decoration: none;">Kebijakan
                        Privasi</a>
                    <a href="/tos.html" style="color: var(--neutral-500); text-decoration: none;">Ketentuan Layanan</a>
                </div>
            </div>
        </footer>
    </div>
</body>

</html>